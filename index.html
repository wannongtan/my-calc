<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å·¥ç¨‹é‡è¨ˆç®—æ©Ÿ</title>
    <style>
        :root { --primary: #007aff; --bg: #f2f2f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; padding-bottom: 40px; }
        .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h2 { color: var(--primary); font-size: 1.1rem; margin-top: 0; border-left: 4px solid var(--primary); padding-left: 10px; }
        .row { display: flex; gap: 8px; margin-bottom: 10px; }
        input, select { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; outline: none; }
        button.add-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        td { padding: 8px 0; border-top: 1px solid #f0f0f0; font-size: 0.9rem; }
        .total { background: #e9f2ff; padding: 12px; border-radius: 10px; color: #0056b3; font-weight: bold; margin-top: 10px; text-align: right; }
        .del-btn { color: #ff3b30; border: none; background: none; padding: 5px; cursor: pointer; }
        .clear-all { text-align: center; margin: 20px 0; }
        .clear-btn { background: #ff3b30; color: white; padding: 10px 25px; border-radius: 8px; border: none; font-size: 14px; cursor: pointer; }
        .formula-hint { font-size: 0.75rem; color: #888; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1 style="text-align:center; font-size:1.4rem;">ğŸ—ï¸ å·¥ç¨‹è¨ˆç®—å°å¹«æ‰‹</h1>

    <div class="card">
        <h2>é«˜ç¨‹è¨ˆç®— (æ”¾æ¨£)</h2>
        <p class="formula-hint">å…¬å¼ï¼š(åŸºæº–é» + å¾Œè¦–) - è¨­è¨ˆé«˜ = ç®±å°ºè®€æ•¸</p>
        <div class="row">
            <input type="number" id="elevBM" placeholder="åŸºæº–é»(BM)">
            <input type="number" id="elevBS" placeholder="å¾Œè¦–(BS)">
            <input type="number" id="elevDesign" placeholder="è¨­è¨ˆé«˜">
        </div>
        <button class="add-btn" onclick="add('leveling')">è¨ˆç®—ä¸¦ç´€éŒ„è®€æ•¸</button>
        <div id="res-leveling"></div>
        <div class="total" id="tot-leveling">æ‡‰è®€æ•¸ï¼š0.000 m</div>
    </div>

    <div class="card">
        <h2>æ°´æ³¥æ¾†ç½® (mÂ³)</h2>
        <div class="row">
            <input type="number" id="cL" placeholder="é•·">
            <input type="number" id="cW" placeholder="å¯¬">
            <input type="number" id="cH" placeholder="é«˜">
        </div>
        <button class="add-btn" onclick="add('concrete')">æ–°å¢æ°´æ³¥ç´€éŒ„</button>
        <div id="res-concrete"></div>
        <div class="total" id="tot-concrete">ç¸½è¨ˆï¼š0.00 mÂ³</div>
    </div>

    <div class="card">
        <h2>é‹¼ç­‹é‡é‡ (kg)</h2>
        <div class="row">
            <select id="rT">
                <option value="0.560">D10 #3 (0.560)</option>
                <option value="0.994">D13 #4 (0.994)</option>
                <option value="1.550">D16 #5 (1.550)</option>
                <option value="2.250">D19 #6 (2.250)</option>
                <option value="3.040">D22 #7 (3.040)</option>
                <option value="3.980">D25 #8 (3.980)</option>
            </select>
            <input type="number" id="rL" placeholder="é•·åº¦">
            <input type="number" id="rN" placeholder="æ ¹æ•¸">
        </div>
        <button class="add-btn" onclick="add('rebar')">æ–°å¢é‹¼ç­‹ç´€éŒ„</button>
        <div id="res-rebar"></div>
        <div class="total" id="tot-rebar">ç¸½è¨ˆï¼š0.00 kg</div>
    </div>

    <div class="card">
        <h2>æ¨¡æ¿é¢ç© (mÂ²)</h2>
        <div class="row">
            <input type="number" id="fL" placeholder="é•·">
            <input type="number" id="fW" placeholder="å¯¬">
            <select id="fSide">
                <option value="1">å–®é¢</option>
                <option value="2">é›™é¢</option>
            </select>
        </div>
        <button class="add-btn" onclick="add('form')">æ–°å¢æ¨¡æ¿ç´€éŒ„</button>
        <div id="res-form"></div>
        <div class="total" id="tot-form">ç¸½è¨ˆï¼š0.00 mÂ²</div>
    </div>

    <div class="clear-all">
        <button class="clear-btn" onclick="clearData()">ğŸ§¨ æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('engData')) || { concrete: [], rebar: [], form: [], leveling: [] };

        function save() {
            localStorage.setItem('engData', JSON.stringify(db));
            render();
        }

        function add(type) {
            if (type === 'leveling') {
                let bm = parseFloat(document.getElementById('elevBM').value) || 0;
                let bs = parseFloat(document.getElementById('elevBS').value) || 0;
                let ds = parseFloat(document.getElementById('elevDesign').value) || 0;
                if(bm && ds) {
                    let reading = (bm + bs) - ds;
                    db.leveling.push({v: reading, t: `BM:${bm}+BS:${bs}-è¨­:${ds}`});
                    // è¨­è¨ˆé«˜é€šå¸¸æ¯é»ä¸åŒï¼Œå¾Œè¦–BSè·ŸåŸºæº–é»BMé€šå¸¸ä¸å‹•ï¼Œæ‰€ä»¥åªæ¸…ç©ºè¨­è¨ˆé«˜
                    document.getElementById('elevDesign').value = '';
                }
            } else if (type === 'concrete') {
                let l = document.getElementById('cL').value, w = document.getElementById('cW').value, h = document.getElementById('cH').value;
                if(l && w && h) {
                    db.concrete.push({v: l*w*h, t: l+'Ã—'+w+'Ã—'+h});
                    document.getElementById('cL').value=''; document.getElementById('cW').value=''; document.getElementById('cH').value='';
                }
            } else if (type === 'rebar') {
                let u = document.getElementById('rT').value, l = document.getElementById('rLen').value, n = document.getElementById('rNum').value;
                if(l && n) {
                    let name = document.getElementById('rT').options[document.getElementById('rT').selectedIndex].text.split(' (')[0];
                    db.rebar.push({v: u*l*n, t: name+' | '+l+'mÃ—'+n+'æ”¯'});
                    document.getElementById('rLen').value=''; document.getElementById('rNum').value='';
                }
            } else if (type === 'form') {
                let l = document.getElementById('fL').value, w = document.getElementById('fW').value, s = document.getElementById('fSide').value;
                if(l && w) {
                    db.form.push({v: l*w*s, t: l+'Ã—'+w+' ('+(s==1?'å–®':'é›™')+')'});
                    document.getElementById('fL').value=''; document.getElementById('fW').value='';
                }
            }
            save();
        }

        function del(type, i) {
            db[type].splice(i, 1);
            save();
        }

        function clearData() {
            if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ')) {
                db = { concrete: [], rebar: [], form: [], leveling: [] };
                save();
            }
        }

        function render() {
            ['concrete', 'rebar', 'form', 'leveling'].forEach(type => {
                let total = 0;
                let html = '<table>';
                db[type].forEach((item, i) => {
                    total = item.v; // é«˜ç¨‹é€šå¸¸é¡¯ç¤ºæœ€å¾Œä¸€ç­†è¨ˆç®—çµæœ
                    if(type !== 'leveling') total = 0; // éé«˜ç¨‹å‰‡é‡æ–°è¨ˆç®—åŠ ç¸½
                    
                    html += '<tr><td>'+item.t+'</td><td align="right">'+item.v.toFixed(3)+'</td>';
                    html += '<td align="right"><button class="del-btn" onclick="del(\''+type+'\','+i+')">åˆªé™¤</button></td></tr>';
                });

                // æ°´æ³¥ã€é‹¼ç­‹ã€æ¨¡æ¿éœ€è¦åŠ ç¸½
                if(type !== 'leveling') {
                    let sum = 0;
                    db[type].forEach(item => sum += item.v);
                    let unit = (type==='concrete'?' mÂ³':(type==='rebar'?' kg':' mÂ²'));
                    document.getElementById('tot-'+type).innerText = 'ç¸½è¨ˆï¼š'+sum.toFixed(2) + unit;
                } else {
                    // é«˜ç¨‹è¨ˆç®—åªé¡¯ç¤ºæœ€å¾Œä¸€ç­†è¨ˆç®—å‡ºçš„è®€æ•¸
                    let lastVal = db.leveling.length > 0 ? db.leveling[db.leveling.length-1].v : 0;
                    document.getElementById('tot-leveling').innerText = 'æ‡‰è®€æ•¸ï¼š'+lastVal.toFixed(3) + ' m';
                }
                
                document.getElementById('res-'+type).innerHTML = html + '</table>';
            });
        }

        render();
    </script>
</body>
</html>
